{% extends "base.html" %}
{% block content %}
<div class="container mt-5">
  <div class="card shadow border-0 rounded-4 p-4" style="background: #f6f7fa;">
    <h2 class="mb-4 text-primary fw-bold" style="font-size: 1.45rem;">
      <i class="bi bi-tools me-2"></i>Process Stage Management (Batch)
    </h2>

    <form method="POST" class="mb-4">
      <div class="row g-3 align-items-end">
        <div class="col-md-5 mb-3">
          <label for="serials" class="form-label fw-semibold">Scan or Paste Serials<br>
            <small class="text-muted">(One per line, or comma/space separated)</small>
          </label>
          <textarea name="serials" id="serials" class="form-control form-control-lg" rows="5" placeholder="Scan or paste serial numbers..." required></textarea>
        </div>
        <div class="col-md-3 mb-3">
          <label for="process_stage" class="form-label fw-semibold">Next Stage</label>
          <select name="process_stage" id="process_stage" class="form-select form-select-lg rounded-pill" required>
            <option value="">Select Stage</option>
            <option value="specs">Specs</option>
            <option value="deployment">Deployment</option>
            <option value="screen_spot">Screen Spot</option>
            <option value="parts_change">Parts Change</option>
            <option value="paint">Paint</option>
            <option value="qc">QC</option>
            <option value="processed">Processed</option>
          </select>
        </div>
        <div class="col-md-3 mb-3">
          <label for="team_assigned" class="form-label fw-semibold">Assign Team</label>
          <input type="text" name="team_assigned" id="team_assigned" class="form-control form-control-lg rounded-pill" placeholder="Assigned Team" required>
        </div>
        <div class="col-md-1 d-grid mb-3">
          <button type="submit" class="btn btn-primary rounded-pill fw-semibold py-2 btn-lg w-100 mt-2">
            <i class="bi bi-arrow-repeat me-1"></i>Process Batch
          </button>
        </div>
      </div>
    </form>

    {% if results %}
    <div style="overflow-x:auto;">
      <table class="table table-hover align-middle rounded-4 overflow-hidden" style="background: #fff;">
        <thead class="table-light">
          <tr>
            <th>Serial</th>
            <th>Model</th>
            <th>Previous Stage</th>
            <th>Result</th>
          </tr>
        </thead>
        <tbody>
          {% for row in results %}
          <tr>
            <td>{{ row.serial }}</td>
            <td>{{ row.model }}</td>
            <td>{{ row.prev_stage }}</td>
            <td>
              {% if row.status == 'updated' %}
                <span class="badge bg-success">Updated</span>
              {% elif row.status == 'not_found' %}
                <span class="badge bg-danger">Not Found</span>
              {% elif row.status == 'no_change' %}
                <span class="badge bg-secondary">Already at Stage</span>
              {% else %}
                <span class="badge bg-warning text-dark">{{ row.status }}</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endif %}

    <div class="mt-3 text-muted">
      <small>Paste or scan serials, choose a stage/team, and process in bulk. Only valid units will be updated.</small>
    </div>
  </div>
</div>
{% endblock %}
